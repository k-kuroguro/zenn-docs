---
title: "数値計算によって等電位線を描画する"
emoji: "🔋"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["rust", "数値計算"]
published: false
---

# 概要

# 立式

$$
\frac{\partial^2\phi}{\partial x^2}+\frac{\partial^2\phi}{\partial y^2}=0 \tag{1}
$$

数値計算のために上式を離散化する. すなわち, 格子点 $(x_i,y_j)$ における $\phi$ の値を求めるということである. いま, 格子点 $(x_{i+1},y_j)$ における $\phi(x_i+\Delta x,y_j)$ を $x$ 方向にテイラー展開すれば

$$
\phi(x_i+\Delta x,y_j) = \phi(x_i,y_j) + \frac{\partial\phi}{\partial x}\Delta x + \frac{1}{2!}\frac{\partial^2\phi}{\partial x^2}\Delta x^2 + \frac{1}{3!}\frac{\partial^3\phi}{\partial x^3}\Delta x^3 + \cdots \tag{2}
$$

格子点 $(x_{i-1},y_j)$ においても同様に

$$
\phi(x_i-\Delta x,y_j) = \phi(x_i,y_j) - \frac{\partial\phi}{\partial x}\Delta x + \frac{1}{2!}\frac{\partial^2\phi}{\partial x^2}\Delta x^2 - \frac{1}{3!}\frac{\partial^3\phi}{\partial x^3}\Delta x^3 + \cdots \tag{3}
$$

式$(2),(3)$の和をとれば, $\Delta x$ の奇数次の項が消えて

$$
\phi(x_i+\Delta x,y_j)+\phi(x_i-\Delta x,y_j) = 2\phi(x_i,y_j) - \frac{1}{2!}\frac{\partial^2\phi}{\partial x^2}\Delta x^2 + O(\Delta x^2) \tag{4}
$$

式$(4)$より

$$
\frac{\partial^2\phi}{\partial x^2} = \frac{1}{\Delta x^2}\{\phi(x_i+\Delta x,y_j)+\phi(x_i-\Delta x,y_j)-2\phi(x_i,y_j)\} \tag{5}
$$

$y$ 方向にも同様に

$$
\frac{\partial^2\phi}{\partial y^2} = \frac{1}{\Delta y^2}\{\phi(x_i,y_j+\Delta y)+\phi(x_i,y_j-\Delta y)-2\phi(x_i,y_j)\} \tag{6}
$$

式$(5),(6)$の和をとれば, 式$(1)$の左辺を $\phi$ の値で表すことができる. $\phi_{i\ j}\equiv\phi(x_i,y_j)$, $\Delta x=\Delta y$ とすれば

$$
\frac{\partial^2\phi}{\partial x^2}+\frac{\partial^2\phi}{\partial y^2}=\phi_{i+1\ j}+\phi_{i-1\ j}+\phi_{i\ j+1}+\phi_{i\ j-1}-4\phi_{i\ j}=0
$$

$\phi_{i\ j}$ について解くと

$$
\phi_{i\ j}=\frac{1}{4}(\phi_{i+1\ j}+\phi_{i-1\ j}+\phi_{i\ j+1}+\phi_{i\ j-1})\ (i,j=1,2,...,n) \tag{7}
$$

よって, 格子点 $(x_i,y_j)$ での $\phi$ の値は, その周囲4格子点の平均値であると示された. また, 式$(7)$は差分方程式であり, 右辺には境界値 $\phi_{0\ j},\phi_{n+1\ j},\phi_{i\ 0},\phi_{i\ n+1}$ が含まれる. よって, 解くためにはこれらの値を定める境界条件が必要である. 今回は次の2条件を考える.

- 電極内の電位.
- 金属箔の端面.

電極については, 両電極の電位差が $2\mathrm{V}$ であるから

$$
\left\{
   \begin{array}{l}
      \phi(x,y)|_{(x-d)^2+y^2=r^2}=V \\
      \phi(x,y)|_{(x+d)^2+y^2=r^2}=-V
   \end{array}
\right.
$$

端面においては, 周囲4格子点ではなく, 3または2点の和を用いればよい.

以上で必要な式が全て求められた.

# 計算

式$(7)$をヤコビ法によって解く. ヤコビ法は, 連立一次方程式を反復法によって解く方法である. $k$ 回目の反復における $\phi_{i\ j}$ の値を $\phi_{i\ j}^{(k)}$ とする. 各格子点で次式を適用し, 目的の精度まで反復を繰り返せばよい.

$$
\phi_{i\ j}^{(k+1)}=\frac{1}{4}(\phi_{i+1\ j}^{(k)}+\phi_{i-1\ j}^{(k)}+\phi_{i\ j+1}^{(k)}+\phi_{i\ j-1}^{(k)})
$$

# 参考サイト

https://www.sci.u-hyogo.ac.jp/material/chem_extreme/equipotential.html
http://www.math-koubou.jp/pde1101.html
https://mathlang.hatenablog.com/entry/2017/09/24/012017
https://home.hirosaki-u.ac.jp/relativity/%E9%9B%BB%E7%A3%81%E6%B0%97%E5%AD%A6-i/%E9%9D%99%E9%9B%BB%E5%A0%B4%EF%BC%9A%E3%83%9D%E3%82%A2%E3%82%BD%E3%83%B3%E6%96%B9%E7%A8%8B%E5%BC%8F%E3%81%AE%E8%A7%A3/
http://tpweb2.phys.konan-u.ac.jp/~keisan_butsuri/keisan_butsuri/c/jacobi.txt
http://tpweb2.phys.konan-u.ac.jp/~keisan_butsuri/keisan_butsuri/c/laplace.txt
http://tpweb2.phys.konan-u.ac.jp/~keisan_butsuri/keisan_butsuri/matplotlib/laplace_plot.txt
file:///C:/Users/sd22034/Downloads/7-3.pdf
http://dsl4.eee.u-ryukyu.ac.jp/DOCS/gnuplot/node132.html
http://www.yamamo10.jp/yamamoto/lecture/2007/5E_comp_app/gnuplot/html/node4.html
https://kiito.hatenablog.com/entry/2019/02/06/095527
http://www.yamamo10.jp/yamamoto/lecture/2006/p1/8th/html/node3.html
http://www.yamamo10.jp/yamamoto/lecture/2006/5E/test_4/html/node4.html
https://watlab-blog.com/2022/09/21/laplace-equation/
https://ja.wikipedia.org/wiki/%E9%9B%BB%E7%A3%81%E3%83%9D%E3%83%86%E3%83%B3%E3%82%B7%E3%83%A3%E3%83%AB
http://tpweb2.phys.konan-u.ac.jp/~keisan_butsuri/keisan_butsuri/pdf/matrix_inv.pdf
https://ja.wikipedia.org/wiki/%E3%83%A4%E3%82%B3%E3%83%93%E6%B3%95
http://tpweb2.phys.konan-u.ac.jp/~keisan_butsuri/keisan_butsuri/pdf/laplace.pdf
https://www.u.tsukuba.ac.jp/~ishiki.goro.gm/CompPhys22/doc/math3-1.html
http://tpweb2.phys.konan-u.ac.jp/~keisan_butsuri/keisan_butsuri/pdf/laplace.pdf
https://bamka.info/copy-all-urls
